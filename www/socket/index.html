<html>
<head>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <script>

        var userIdStr = userIdStr();
        var clientId = '';
        var websocket = null;

        function userIdStr() {
            var max = 1000;
            return 'USR' + Math.floor(Math.random() * Math.floor(max));
        }


        function showMessage(messageHTML) {
            //$('#chat-box').append(messageHTML);
        }

        $(document).ready(function(){

            $('#userIdStr').html(userIdStr);

            $('#Connect').click(function() {

                websocket = new WebSocket("ws://localhost:8080/", 'echo-protocol');

                console.log(websocket);

                websocket.onopen = function(event) {
                    showMessage("<div class='chat-connection-ack' style='color:green'>Connection is established!</div>");
                };

                websocket.onmessage = function(event) {
                    console.log(event.data);
                    logging(event.data);
                    showMessage("<div style='color:green'>"+event.data+"</div>");
                    return true;


                    console.log(event.data);
                    var Data = JSON.parse(event.data);

                    logging(event.data);

                    // Server asks for auth
                    if(Data.message_type == 'auth-required') {

                        clientId = Data.clientId;

                        var messageJSON = {
                            messageType: 'Auth',
                            clientId: clientId,
                            userIdStr: userIdStr,
                            AccessToken: 'sd876sd879hgd78fdsf879dfs897fds789dfs897dfs789fd879fd879df87df',
                            chat_message:'asdsdsd',
                            name:$('#chat-user').val(),
                            message:$('#chat-message').val(),
                        };

                        websocket.send(JSON.stringify(messageJSON));

                        showMessage("<div class='"+Data.message_type+"' style='color:green'>Authorizing "+Data.message+"</div>");

                    } else {
                        showMessage("<div class='"+Data.message_type+"' style='color:green'>"+Data.message+"</div>");
                        $('#chat-message').val('');
                    }

                };

                websocket.onerror = function(event){
                    showMessage("<div class='error' style='color:red'>Problem due to some Error</div>");
                    console.error("WebSocket error observed:", event);
                };
                websocket.onclose = function(event){
                    showMessage("<div class='chat-connection-ack' style='color:orange'>Connection Closed</div>");
                };

            });

            $('#DisConnect').click(function() {
                if (websocket.readyState === WebSocket.OPEN) {
                    websocket.close();
                }
            });

            $('#frmChat').on("submit",function(event){
                event.preventDefault();
                //$('#chat-user').attr("type","hidden");

                if($('#toPerson').val() != '') {
                    var messageJSON = {
                        chat_user: $('#chat-user').val(),
                        chat_message: $('#chat-message').val(),
                        name:$('#chat-user').val(),
                        message:$('#chat-message').val(),
                        messageType: 'toPerson',
                        toUserIdStr: $('#toPerson').val(),
                        clientId: clientId,
                    };
                } else {
                    var messageJSON = {
                        chat_user: $('#chat-user').val(),
                        chat_message: $('#chat-message').val(),
                        name:$('#chat-user').val(),
                        message:$('#chat-message').val(),
                        messageType: 'Message',
                        clientId: clientId,
                    };
                }


                websocket.send(JSON.stringify(messageJSON));
            });
        });

        function logging(message) {
            var msg = $('#logging').html();
            $('#logging').html(message + "<br>" + msg);
        }

        setInterval(function() {

            var messageJSON = {
                chat_user: $('#chat-user').val(),
                chat_message: $('#chat-message').val(),
                name:$('#chat-user').val(),
                message:$('#chat-message').val(),
                messageType: 'Message',
                clientId: clientId,
            };

            websocket.send(JSON.stringify(messageJSON));

        }, 5000);

    </script>
    <title>Web Socket example</title>
</head>
<body>
<form id="frmChat">
    <input type="button" value="Connect" id="Connect">     <input type="button" value="DisConnect" id="DisConnect">
    <br><br>
<textarea id="chat-message"></textarea>
<button type="submit">Send</button>
</form>
Your name: <input type="text" id="chat-user" value="Davs"><span id="userIdStr"></span><br>
To Prrson: <input type="text" id="toPerson" value=""><br>
<div id="chat-box">

</div>
<div id="logging" style="height:550px;width:600px;overflow-y: scroll">

</div>
</body>
</html>